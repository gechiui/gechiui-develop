{"version":3,"file":"list-reusable-blocks.js","sources":["webpack://gc/webpack/bootstrap","webpack://gc/./node_modules/@gechiui/list-reusable-blocks/build-module/components/import-dropdown/@gechiui/list-reusable-blocks/src/components/import-dropdown/index.js","webpack://gc/./node_modules/@gechiui/list-reusable-blocks/build-module/components/import-form/@gechiui/list-reusable-blocks/src/components/import-form/index.js","webpack://gc/./node_modules/@gechiui/list-reusable-blocks/build-module/@gechiui/list-reusable-blocks/src/index.js","webpack://gc/./node_modules/@gechiui/list-reusable-blocks/build-module/utils/@gechiui/list-reusable-blocks/src/utils/export.js","webpack://gc/./node_modules/@gechiui/list-reusable-blocks/build-module/utils/@gechiui/list-reusable-blocks/src/utils/file.js","webpack://gc/./node_modules/@gechiui/list-reusable-blocks/build-module/utils/@gechiui/list-reusable-blocks/src/utils/import.js","webpack://gc/external [\"gc\",\"apiFetch\"]","webpack://gc/external [\"gc\",\"components\"]","webpack://gc/external [\"gc\",\"compose\"]","webpack://gc/external [\"gc\",\"element\"]","webpack://gc/external [\"gc\",\"i18n\"]","webpack://gc/external \"lodash\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./node_modules/@gechiui/list-reusable-blocks/build-module/index.js\");\n","/**\n * External dependencies\n */\nimport { flow } from 'lodash';\n\n/**\n * GeChiUI dependencies\n */\nimport { __ } from '@gechiui/i18n';\nimport { Dropdown, Button } from '@gechiui/components';\n\n/**\n * Internal dependencies\n */\nimport ImportForm from '../import-form';\n\nfunction ImportDropdown( { onUpload } ) {\n\treturn (\n\t\t<Dropdown\n\t\t\tposition=\"bottom right\"\n\t\t\tcontentClassName=\"list-reusable-blocks-import-dropdown__content\"\n\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t<Button\n\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Import from JSON' ) }\n\t\t\t\t</Button>\n\t\t\t) }\n\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t<ImportForm onUpload={ flow( onClose, onUpload ) } />\n\t\t\t) }\n\t\t/>\n\t);\n}\n\nexport default ImportDropdown;\n","/**\n * GeChiUI dependencies\n */\nimport { Component } from '@gechiui/element';\nimport { withInstanceId } from '@gechiui/compose';\nimport { __, _x } from '@gechiui/i18n';\nimport { Button, Notice } from '@gechiui/components';\n\n/**\n * Internal dependencies\n */\nimport importReusableBlock from '../../utils/import';\n\nclass ImportForm extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\tisLoading: false,\n\t\t\terror: null,\n\t\t\tfile: null,\n\t\t};\n\n\t\tthis.isStillMounted = true;\n\t\tthis.onChangeFile = this.onChangeFile.bind( this );\n\t\tthis.onSubmit = this.onSubmit.bind( this );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.isStillMounted = false;\n\t}\n\n\tonChangeFile( event ) {\n\t\tthis.setState( { file: event.target.files[ 0 ], error: null } );\n\t}\n\n\tonSubmit( event ) {\n\t\tevent.preventDefault();\n\t\tconst { file } = this.state;\n\t\tconst { onUpload } = this.props;\n\t\tif ( ! file ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.setState( { isLoading: true } );\n\t\timportReusableBlock( file )\n\t\t\t.then( ( reusableBlock ) => {\n\t\t\t\tif ( ! this.isStillMounted ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setState( { isLoading: false } );\n\t\t\t\tonUpload( reusableBlock );\n\t\t\t} )\n\t\t\t.catch( ( error ) => {\n\t\t\t\tif ( ! this.isStillMounted ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet uiMessage;\n\t\t\t\tswitch ( error.message ) {\n\t\t\t\t\tcase 'Invalid JSON file':\n\t\t\t\t\t\tuiMessage = __( 'Invalid JSON file' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Invalid Reusable block JSON file':\n\t\t\t\t\t\tuiMessage = __( 'Invalid Reusable block JSON file' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tuiMessage = __( 'Unknown error' );\n\t\t\t\t}\n\n\t\t\t\tthis.setState( { isLoading: false, error: uiMessage } );\n\t\t\t} );\n\t}\n\n\tonDismissError() {\n\t\tthis.setState( { error: null } );\n\t}\n\n\trender() {\n\t\tconst { instanceId } = this.props;\n\t\tconst { file, isLoading, error } = this.state;\n\t\tconst inputId = 'list-reusable-blocks-import-form-' + instanceId;\n\t\treturn (\n\t\t\t<form\n\t\t\t\tclassName=\"list-reusable-blocks-import-form\"\n\t\t\t\tonSubmit={ this.onSubmit }\n\t\t\t>\n\t\t\t\t{ error && (\n\t\t\t\t\t<Notice\n\t\t\t\t\t\tstatus=\"error\"\n\t\t\t\t\t\tonRemove={ () => this.onDismissError() }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ error }\n\t\t\t\t\t</Notice>\n\t\t\t\t) }\n\t\t\t\t<label\n\t\t\t\t\thtmlFor={ inputId }\n\t\t\t\t\tclassName=\"list-reusable-blocks-import-form__label\"\n\t\t\t\t>\n\t\t\t\t\t{ __( 'File' ) }\n\t\t\t\t</label>\n\t\t\t\t<input\n\t\t\t\t\tid={ inputId }\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\tonChange={ this.onChangeFile }\n\t\t\t\t/>\n\t\t\t\t<Button\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\tisBusy={ isLoading }\n\t\t\t\t\tdisabled={ ! file || isLoading }\n\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\tclassName=\"list-reusable-blocks-import-form__button\"\n\t\t\t\t>\n\t\t\t\t\t{ _x( 'Import', 'button label' ) }\n\t\t\t\t</Button>\n\t\t\t</form>\n\t\t);\n\t}\n}\n\nexport default withInstanceId( ImportForm );\n","/**\n * GeChiUI dependencies\n */\nimport { render } from '@gechiui/element';\nimport { __ } from '@gechiui/i18n';\n\n/**\n * Internal dependencies\n */\nimport exportReusableBlock from './utils/export';\nimport ImportDropdown from './components/import-dropdown';\n\n// Setup Export Links\ndocument.body.addEventListener( 'click', ( event ) => {\n\tif (\n\t\t! event.target.classList.contains( 'gc-list-reusable-blocks__export' )\n\t) {\n\t\treturn;\n\t}\n\tevent.preventDefault();\n\texportReusableBlock( event.target.dataset.id );\n} );\n\n// Setup Import Form\ndocument.addEventListener( 'DOMContentLoaded', () => {\n\tconst button = document.querySelector( '.page-title-action' );\n\tif ( ! button ) {\n\t\treturn;\n\t}\n\n\tconst showNotice = () => {\n\t\tconst notice = document.createElement( 'div' );\n\t\tnotice.className = 'notice notice-success is-dismissible';\n\t\tnotice.innerHTML = `<p>${ __(\n\t\t\t'Reusable block imported successfully!'\n\t\t) }</p>`;\n\n\t\tconst headerEnd = document.querySelector( '.gc-header-end' );\n\t\tif ( ! headerEnd ) {\n\t\t\treturn;\n\t\t}\n\t\theaderEnd.parentNode.insertBefore( notice, headerEnd );\n\t};\n\n\tconst container = document.createElement( 'div' );\n\tcontainer.className = 'list-reusable-blocks__container';\n\tbutton.parentNode.insertBefore( container, button );\n\trender( <ImportDropdown onUpload={ showNotice } />, container );\n} );\n","/**\n * External dependencies\n */\nimport { kebabCase } from 'lodash';\n\n/**\n * GeChiUI dependencies\n */\nimport apiFetch from '@gechiui/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport { download } from './file';\n\n/**\n * Export a reusable block as a JSON file.\n *\n * @param {number} id\n */\nasync function exportReusableBlock( id ) {\n\tconst postType = await apiFetch( { path: `/gc/v2/types/gc_block` } );\n\tconst post = await apiFetch( {\n\t\tpath: `/gc/v2/${ postType.rest_base }/${ id }?context=edit`,\n\t} );\n\tconst title = post.title.raw;\n\tconst content = post.content.raw;\n\tconst fileContent = JSON.stringify(\n\t\t{\n\t\t\t__file: 'gc_block',\n\t\t\ttitle,\n\t\t\tcontent,\n\t\t},\n\t\tnull,\n\t\t2\n\t);\n\tconst fileName = kebabCase( title ) + '.json';\n\n\tdownload( fileName, fileContent, 'application/json' );\n}\n\nexport default exportReusableBlock;\n","/**\n * Downloads a file.\n *\n * @param {string} fileName    File Name.\n * @param {string} content     File Content.\n * @param {string} contentType File mime type.\n */\nexport function download( fileName, content, contentType ) {\n\tconst file = new window.Blob( [ content ], { type: contentType } );\n\n\t// IE11 can't use the click to download technique\n\t// we use a specific IE11 technique instead.\n\tif ( window.navigator.msSaveOrOpenBlob ) {\n\t\twindow.navigator.msSaveOrOpenBlob( file, fileName );\n\t} else {\n\t\tconst a = document.createElement( 'a' );\n\t\ta.href = URL.createObjectURL( file );\n\t\ta.download = fileName;\n\n\t\ta.style.display = 'none';\n\t\tdocument.body.appendChild( a );\n\t\ta.click();\n\t\tdocument.body.removeChild( a );\n\t}\n}\n\n/**\n * Reads the textual content of the given file.\n *\n * @param {File} file File.\n * @return {Promise<string>}  Content of the file.\n */\nexport function readTextFile( file ) {\n\tconst reader = new window.FileReader();\n\treturn new Promise( ( resolve ) => {\n\t\treader.onload = () => {\n\t\t\tresolve( reader.result );\n\t\t};\n\t\treader.readAsText( file );\n\t} );\n}\n","/**\n * External dependencies\n */\nimport { isString } from 'lodash';\n\n/**\n * GeChiUI dependencies\n */\nimport apiFetch from '@gechiui/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport { readTextFile } from './file';\n\n/**\n * Import a reusable block from a JSON file.\n *\n * @param {File} file File.\n * @return {Promise} Promise returning the imported reusable block.\n */\nasync function importReusableBlock( file ) {\n\tconst fileContent = await readTextFile( file );\n\tlet parsedContent;\n\ttry {\n\t\tparsedContent = JSON.parse( fileContent );\n\t} catch ( e ) {\n\t\tthrow new Error( 'Invalid JSON file' );\n\t}\n\tif (\n\t\tparsedContent.__file !== 'gc_block' ||\n\t\t! parsedContent.title ||\n\t\t! parsedContent.content ||\n\t\t! isString( parsedContent.title ) ||\n\t\t! isString( parsedContent.content )\n\t) {\n\t\tthrow new Error( 'Invalid Reusable block JSON file' );\n\t}\n\tconst postType = await apiFetch( { path: `/gc/v2/types/gc_block` } );\n\tconst reusableBlock = await apiFetch( {\n\t\tpath: `/gc/v2/${ postType.rest_base }`,\n\t\tdata: {\n\t\t\ttitle: parsedContent.title,\n\t\t\tcontent: parsedContent.content,\n\t\t\tstatus: 'publish',\n\t\t},\n\t\tmethod: 'POST',\n\t} );\n\n\treturn reusableBlock;\n}\n\nexport default importReusableBlock;\n","(function() { module.exports = window[\"gc\"][\"apiFetch\"]; }());","(function() { module.exports = window[\"gc\"][\"components\"]; }());","(function() { module.exports = window[\"gc\"][\"compose\"]; }());","(function() { module.exports = window[\"gc\"][\"element\"]; }());","(function() { module.exports = window[\"gc\"][\"i18n\"]; }());","(function() { module.exports = window[\"lodash\"]; }());"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAHA;AADA;AASA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AADA;AAZA;AAiBA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AARA;AACA;AAUA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAFA;AAMA;AACA;AAFA;AAQA;AACA;AAFA;AAOA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AALA;AAWA;AACA;AAxGA;AACA;AAyGA;;;;;;;;;;;;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;;;;;;;;;;;;;AChDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAHA;AAQA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACzCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAOA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAPA;AAUA;AACA;AACA;AACA;;;;;;;;;;;;ACpDA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;A","sourceRoot":""}